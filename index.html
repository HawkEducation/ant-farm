<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Plants: 1000 Day Empire üêú</title>
    <style>
        body { background: #1a1a1a; color: #e0e0e0; font-family: 'Courier New', monospace; text-align: center; margin: 0; padding: 10px; }
        #game-container { max-width: 500px; margin: 0 auto; background: #262626; padding: 20px; border-radius: 15px; border: 3px solid #00ffff; position: relative; }
        
        .hp-bg { width: 100%; height: 12px; background: #441111; border-radius: 6px; margin: 5px 0; border: 1px solid #333; overflow: hidden; }
        .hp-fill { height: 100%; background: #00ff00; transition: width 0.3s; }
        #enemy-bar { background: #ff4444; }

        .stat-box { display: flex; flex-wrap: wrap; justify-content: space-around; background: #000; padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #333; }
        .stat { color: #00ffff; font-weight: bold; }
        
        button { background: #00ffff; color: #111; border: none; padding: 12px; font-weight: bold; border-radius: 8px; cursor: pointer; margin: 5px; width: 90%; font-size: 1rem; }
        button:disabled { background: #444; color: #888; cursor: not-allowed; }
        
        .battle-zone { background: #4a0000; padding: 15px; border-radius: 10px; display: none; border: 2px solid #ff0000; margin: 10px 0; }
        #combat-log { font-size: 0.75em; color: #ffcccc; height: 60px; overflow-y: hidden; background: #000; padding: 5px; border-radius: 5px; text-align: left; border: 1px solid #444; }
    </style>
</head>
<body onload="updateUI()">

<div id="game-container">
    <div id="queen-hp-area">
        <div class="hp-bg"><div id="queen-bar" class="hp-fill" style="width: 100%;"></div></div>
        <small>QUEEN HEALTH: <span id="q-hp-text">100</span>/100</small>
    </div>

    <h1>Day: <span id="day-display">1</span></h1>
    
    <div class="stat-box">
        <div>Workers: <span id="ant-count" class="stat">1</span></div>
        <div>Soldiers: <span id="soldier-count" class="stat">0</span></div>
        <div>Bread: <span id="bread-count" class="stat">0</span></div>
    </div>

    <div id="battle-ui" class="battle-zone">
        <strong style="color: #ff4444;">‚ö†Ô∏è NEST UNDER ATTACK!</strong>
        <div class="hp-bg"><div id="enemy-bar" class="hp-fill" style="width: 100%;"></div></div>
        <small>Enemy HP: <span id="e-hp-text">0</span></small>
        <button onclick="manualAttack()" style="background: #ff0000; color: white; margin-top: 10px;">DEFENSIVE STRIKE ‚öîÔ∏è</button>
        <div id="combat-log"></div>
    </div>

    <div id="controls">
        <button id="forage-btn" onclick="forage()">Gather Seeds (+<span id="yield">1</span>) üåæ</button>
        <div style="font-size: 0.8em; margin: 5px;">Seeds: <span id="seed-count" class="stat">0</span></div>
        <hr style="border: 0; border-top: 1px solid #444;">
        <button id="bakery-btn" onclick="startBakery()">Bakery (5 Seeds ‚Üí 5 Bread) ü•ñ</button>
        <button id="soldier-btn" onclick="trainSoldier()">Train Soldier (15 Bread | 20 HP) üõ°Ô∏è</button>
        <button id="upgrade-btn" onclick="upgradeColony()">Upgrade Mandibles üí™</button>
    </div>
</div>

<script>
    let ants = 1, soldiers = 0, seeds = 0, bread = 0, day = 1;
    let queenHP = 100, pickupAmount = 1, upgradeCost = 10;
    let enemyHP = 0, maxEnemyHP = 0, inBattle = false;
    let soldierHPList = []; // Tracks HP of individual soldiers

    function log(msg) {
        const l = document.getElementById('combat-log');
        l.innerHTML = "> " + msg + "<br>" + l.innerHTML;
    }

    function updateUI() {
        document.getElementById('ant-count').innerText = ants;
        document.getElementById('soldier-count').innerText = soldiers;
        document.getElementById('bread-count').innerText = bread;
        document.getElementById('seed-count').innerText = seeds;
        document.getElementById('day-display').innerText = day;
        document.getElementById('yield').innerText = pickupAmount;
        document.getElementById('upgrade-btn').innerText = `Mandible Upgrade (${upgradeCost} Bread)`;
        
        // Queen HP
        document.getElementById('queen-bar').style.width = queenHP + "%";
        document.getElementById('q-hp-text').innerText = Math.max(0, queenHP);

        // Enemy UI
        if (inBattle) {
            document.getElementById('battle-ui').style.display = 'block';
            document.getElementById('enemy-bar').style.width = (enemyHP / maxEnemyHP * 100) + "%";
            document.getElementById('e-hp-text').innerText = Math.ceil(enemyHP);
            document.getElementById('forage-btn').disabled = true;
            document.getElementById('forage-btn').innerText = "NEST BLOCKED!";
        } else {
            document.getElementById('battle-ui').style.display = 'none';
            document.getElementById('forage-btn').disabled = false;
            document.getElementById('forage-btn').innerText = "Gather Seeds";
        }

        // Button States
        document.getElementById('bakery-btn').disabled = (seeds < 5);
        document.getElementById('soldier-btn').disabled = (bread < 15);
        document.getElementById('upgrade-btn').disabled = (bread < upgradeCost);
    }

    // Fixed Forage Function
    function forage() {
        if (!inBattle) {
            seeds += pickupAmount;
            updateUI();
        }
    }

    function trainSoldier() {
        if (bread >= 15) {
            bread -= 15;
            soldiers++;
            soldierHPList.push(20); // Give new soldier 20 HP
            updateUI();
        }
    }

    function startBakery() {
        if (seeds >= 5) {
            seeds -= 5;
            updateUI();
            setTimeout(() => {
                bread += 5;
                ants += 2;
                updateUI();
            }, 2000);
        }
    }

    function triggerInvasion() {
        inBattle = true;
        maxEnemyHP = 20 + (day * 3);
        enemyHP = maxEnemyHP;
        updateUI();
        log("Wild Colony has invaded!");
    }

    function manualAttack() {
        if (inBattle) {
            let dmg = 2 + (pickupAmount * 0.5);
            enemyHP -= dmg;
            log(`You dealt ${dmg.toFixed(1)} dmg!`);
            checkVictory();
        }
    }

    function checkVictory() {
        if (enemyHP <= 0) {
            inBattle = false;
            enemyHP = 0;
            log("Area Secured.");
            updateUI();
        }
    }

    // Combat & Day Cycle
    setInterval(() => {
        if (inBattle) {
            // Soldiers fight
            if (soldiers > 0) {
                enemyHP -= (soldiers * 1.5);
                // Enemy fights back against first soldier
                soldierHPList[0] -= 4;
                if (soldierHPList[0] <= 0) {
                    soldierHPList.shift();
                    soldiers--;
                    log("A Soldier was lost.");
                }
            } else {
                // Enemy hits Queen directly
                queenHP -= 5;
                log("QUEEN IS TAKING DAMAGE!");
            }

            if (queenHP <= 0) {
                alert("The Queen has fallen. Days survived: " + day);
                location.reload();
            }
            checkVictory();
            updateUI();
        } else {
            // Soldiers heal 1 HP per second while resting
            soldierHPList = soldierHPList.map(hp => Math.min(20, hp + 1));
        }
    }, 1000);

    setInterval(() => {
        if (!inBattle) {
            day++;
            if (day > 5 && Math.random() > 0.85) triggerInvasion();
            updateUI();
        }
    }, 4000);

    function upgradeColony() {
        if (bread >= upgradeCost) {
            bread -= upgradeCost;
            pickupAmount += 3;
            upgradeCost = Math.floor(upgradeCost * 2.2);
            updateUI();
        }
    }
</script>
</body>
</html>
